workflows:
  flutter-ios-simulator:
    name: Flutter iOS Simulator Build
    max_build_duration: 120 # В минутах
    instance_type: mac_mini_m2 # Или mac_mini_m1 для экономии

    environment:
      flutter: stable # Версия Flutter (stable, beta или dev)
      xcode: latest # Последняя версия Xcode
      cocoapods: default # Автоматически запустит pod install, если нужно

    scripts:
      - name: Установить зависимости Flutter
        script: flutter pub get

      - name: Собрать для симулятора (без подписи)
        script: |
          flutter build ios --release \
            --no-codesign \
            --simulator \
            --target-platform=ios

      # Опционально: Запаковать .app в ZIP для удобства скачивания
      - name: Запаковать артефакт
        script: |
          APP_DIR="build/ios/Release-iphoneos/Runner.app"
          ZIP_FILE="Runner-simulator.zip"
          zip -r "$ZIP_FILE" "$APP_DIR"

    artifacts:
      - build/ios/**/*.app # Основной .app-файл
      - Runner-simulator.zip # ZIP-архив
